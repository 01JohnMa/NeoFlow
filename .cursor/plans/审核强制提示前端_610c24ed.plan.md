---
name: 审核强制提示前端
overview: 在审核编辑页保存时拦截后端校验错误，并用自定义 Modal 弹窗提示字段必须值。
todos:
  - id: ui-modal
    content: 新增通用Modal组件供提示使用
    status: completed
  - id: review-save
    content: 审核保存失败时弹窗提示并阻断
    status: completed
  - id: verify
    content: 手工验证非法值提示与合法值保存
    status: completed
isProject: false
---

# 前端修改计划

## 目标

- 在审核编辑页保存时，若后端返回强制审核校验失败（HTTP 400），阻断保存并弹出明确提示。
- 采用自定义 Modal 组件（保持 UI 一致，可复用）。

## 涉及文件

- [`web/src/pages/DocumentDetail.tsx`](web/src/pages/DocumentDetail.tsx)
- [`web/src/services/api.ts`](web/src/services/api.ts)（仅用于读取错误结构，无需改动）
- 新增 [`web/src/components/ui/modal.tsx`](web/src/components/ui/modal.tsx)

## 实施步骤

1. **新增通用 Modal 组件**

   - 在 `web/src/components/ui/modal.tsx` 增加一个轻量弹窗组件（遮罩 + 标题 + 内容 + 确认按钮），可通过 `open/onClose` 控制。
   - 样式沿用现有 UI 规范（字体/颜色/按钮同 `Button`）。

2. **审核保存时拦截错误并弹窗**

   - 在 `DocumentDetail` 增加状态：`isModalOpen`、`modalMessage`。
   - `handleSave` 的 `catch` 中解析错误信息：优先读取 `error.response.data.detail`；否则回退到通用“审核失败”提示。
   - 打开 Modal 并阻断保存（不切换 `isEditing`）。

3. **保证可用性与一致性**

   - Modal 仅在审核保存失败时显示，不影响其它流程（重命名、删除、重新处理）。
   - Modal 关闭后保持当前编辑内容，方便用户修正再保存。

## 关键位置（参考）

- 审核保存逻辑：
```92:110:web/src/pages/DocumentDetail.tsx
const handleSave = async () => {
  // ... validateMutation.mutateAsync(...)
}
```


## 测试要点

- 在“检测报告”中将 `inspection_conclusion` 改为非法值（如“通过”）→ 保存时弹窗提示“字段【检验结论】必须为：合格 / 不合格”。
- 填写合法值（“合格/不合格”）→ 正常保存并退出编辑态。