# NeoFlow 智能文档处理平台 - 项目汇报

## 1. 项目背景 (Project Background)

### 现状痛点
- **质量运营部**：日常处理大量纸质/PDF文档（检测报告、快递单、抽样单），人工录入飞书多维表格耗时耗力，易出错。
- **照明系统部**：需要处理专业的实验室测试数据（积分球测试、光分布测试），数据维度多，且需要将多份报告数据合并分析。
- **跨部门协作**：各部门数据孤岛，缺乏统一的数字化归档与检索平台。

### 业务需求
- **自动化提取**：利用 OCR 和 LLM 技术自动提取非结构化文档中的关键信息。
- **多租户支持**：系统需同时支持质量运营、照明系统等多个部门，且数据互不干扰，流程各自独立。
- **灵活扩展**：后续可快速复用至其他部门（如行政、财务等）。

---

## 2. 项目目标 (Project Goals)

### 核心目标
打造一个**多租户、配置化、智能化的文档处理平台 (NeoFlow)**。

### 具体产出
1.  **统一工作台**：支持多部门登录，根据租户权限动态展示业务模块。
2.  **智能提取引擎**：
    *   **通用提取**：支持快递单、抽样单等标准单据。
    *   **复杂合并**：支持照明部门"积分球+光分布"多份报告合并提取为一份综合记录。
3.  **飞书深度集成**：提取结果自动推送到各部门对应的飞书多维表格，实现业务闭环。
4.  **配置化架构**：新增部门或文档类型时，无需修改代码，仅需配置模板和 Prompt。

---

## 3. 成功衡量标准 (Success Metrics)

### 效率指标
- **单单处理时间**：从上传到入库 < 30秒/份（对比人工录入 3-5分钟/份）。
- **自动化率**：核心字段自动提取准确率 > 95%（人工仅需简单校验）。

### 业务指标
- **覆盖场景**：成功支持质量运营（3种单据）和照明系统（合并报告）两大核心场景。
- **多租户隔离**：各部门数据权限严格隔离，配置互不影响。

### 技术指标
- **系统稳定性**：API 服务可用性 > 99%。
- **扩展性**：新增一个标准文档模板的配置时间 < 1小时。

---

## 4. 实施方案 (Implementation)

### 技术架构
- **前端**：React + TypeScript + Tailwind CSS (动态表单，实时预览)。
- **后端**：FastAPI (高性能异步接口)。
- **AI核心**：
    *   **OCR**：PaddleOCR (本地部署 PP-OCRv5，高精度中文识别)。
    *   **Agent**：LangGraph (编排工作流：识别 -> 分类 -> 提取 -> 校验)。
    *   **LLM**：OpenAI/DeepSeek (语义理解与结构化输出)。
- **数据层**：Supabase (PostgreSQL + Vector)，支持 Row Level Security (RLS) 实现多租户隔离。

### 核心功能实现
1.  **多租户系统**：
    *   用户注册时选择部门，自动绑定 Tenant ID。
    *   数据表字段级隔离，利用 RLS 策略确保数据安全。
2.  **动态模板引擎**：
    *   **Single模式**：标准文档（如检测报告）单文件提取。
    *   **Merge模式**：照明报告（积分球+光分布）双文件关联提取，自动聚合字段。
3.  **动态 Prompt 构建 (Dynamic Prompt Construction)**：
    *   **字段定义**：运行时从数据库拉取模板字段配置，自动生成 Markdown 格式的目标字段表（含类型提示）。
    *   **Few-shot 注入**：根据模板配置动态检索并注入高质量的 Few-shot 示例（OCR文本 + 期望JSON），提升 LLM 准确率。
    *   **实时组装**：将文档类型、字段约束、示例与当前 OCR 文本实时组装成最终 Prompt，无需硬编码。
4.  **Agentic Workflow**：
    *   引入 "Human-in-the-loop"（人机交互），AI 提取后支持人工审核修正，修正结果反向优化 Prompt (Few-shot)。

---

## 5. 当前进展 (Current Status)

### ✅ 已完成 (Completed)
- **核心能力**：OCR 识别链路与 LLM 提取工作流已跑通。
- **多租户架构**：数据库表结构改造完成，支持租户、模板、字段的配置化。
- **业务场景落地**：
    *   **质量运营**：检测报告（原测试单/检验报告统一）、快递单、抽样单已上线。
    *   **照明系统**：支持积分球与光分布报告的上传与合并提取。
- **前端重构**：注册页支持部门选择，上传页根据模板动态渲染。
- **飞书集成**：支持按租户配置不同的飞书多维表格推送目标。

### 🚧 进行中 (In Progress)
- **管理员后台**：开发可视化界面，用于管理租户、配置新模板和 Prompt（目前需数据库配置）。
- **生产环境部署**：Supabase 本地化部署验证，Docker 容器化封装。

### 📅 下一步计划 (Next Steps)
- **Phase 1**：完善管理员后台，交付给部门管理员自行配置。
- **Phase 2**：引入数据统计大屏，展示各部门提效成果。
- **Phase 3**：推广至第三个试点部门。
